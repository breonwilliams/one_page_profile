<!DOCTYPE html>
<html>
<head>
    <title>Get Threads Token</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #6C5BB9;
            border-radius: 4px;
        }
        .code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
        }
        button {
            background: #6C5BB9;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #5a4a9a;
        }
        .error {
            color: red;
            margin: 10px 0;
        }
        .success {
            color: green;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Get Threads Access Token</h1>
        
        <div class="step">
            <h3>Step 1: Authorize with Threads</h3>
            <p>Click the button below to authorize your app with Threads permissions:</p>
            <button onclick="authorizeThreads()">Authorize Threads Access</button>
        </div>

        <div class="step">
            <h3>Step 2: Get Authorization Code</h3>
            <p>After authorizing, you'll be redirected back. Copy the code from the URL and paste it here:</p>
            <input type="text" id="authCode" placeholder="Paste authorization code here" style="width: 100%; padding: 8px; margin: 10px 0;">
            <button onclick="exchangeCode()">Exchange Code for Token</button>
            <div id="codeResult"></div>
        </div>

        <div class="step">
            <h3>Step 3: Exchange for Long-Lived Token</h3>
            <p>Once you have a short-lived token, click below to exchange it for a long-lived token:</p>
            <input type="text" id="shortToken" placeholder="Short-lived token will appear here" style="width: 100%; padding: 8px; margin: 10px 0;">
            <input type="password" id="appSecret" placeholder="Enter your App Secret" style="width: 100%; padding: 8px; margin: 10px 0;">
            <button onclick="getLongLivedToken()">Get Long-Lived Token</button>
            <div id="longTokenResult"></div>
        </div>

        <div class="step" id="finalResult" style="display: none;">
            <h3>âœ… Success! Your Long-Lived Token:</h3>
            <div class="code" id="finalToken"></div>
            <p>This token expires in 60 days. Copy it and update your .env.local file.</p>
        </div>
    </div>

    <script>
        const APP_ID = '24286019167706703';  // Correct Threads App ID
        const REDIRECT_URI = 'http://localhost:3000/callback';
        
        function authorizeThreads() {
            // Threads OAuth URL with proper scopes
            const authUrl = `https://threads.net/oauth/authorize?` +
                `client_id=${APP_ID}&` +
                `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
                `scope=threads_basic,threads_content_publish,threads_manage_insights,threads_manage_replies,threads_read_replies&` +
                `response_type=code`;
            
            window.open(authUrl, '_blank');
            
            document.getElementById('codeResult').innerHTML = 
                '<p class="success">Authorization window opened. After authorizing, you\'ll be redirected to a page that shows an error (this is normal). Copy the "code" parameter from the URL.</p>' +
                '<p>The URL will look like: <span class="code">http://localhost:3000/callback?code=YOUR_CODE_HERE#_</span></p>';
        }
        
        async function exchangeCode() {
            const code = document.getElementById('authCode').value;
            if (!code) {
                alert('Please enter the authorization code');
                return;
            }
            
            // Note: This needs to be done server-side in production
            // For now, showing the curl command to run
            const curlCommand = `curl -X POST "https://graph.threads.net/oauth/access_token" \\
  -F "client_id=${APP_ID}" \\
  -F "client_secret=YOUR_APP_SECRET" \\
  -F "grant_type=authorization_code" \\
  -F "redirect_uri=${REDIRECT_URI}" \\
  -F "code=${code}"`;
            
            document.getElementById('codeResult').innerHTML = 
                '<p>Run this command in your terminal (replace YOUR_APP_SECRET with your actual app secret):</p>' +
                '<div class="code">' + curlCommand.replace(/\n/g, '<br>') + '</div>' +
                '<p>Then paste the resulting access_token in Step 3.</p>';
        }
        
        function getLongLivedToken() {
            const shortToken = document.getElementById('shortToken').value;
            const appSecret = document.getElementById('appSecret').value;
            
            if (!shortToken || !appSecret) {
                alert('Please enter both the short-lived token and app secret');
                return;
            }
            
            const curlCommand = `curl -X GET "https://graph.facebook.com/v18.0/oauth/access_token?grant_type=fb_exchange_token&client_id=${APP_ID}&client_secret=${appSecret}&fb_exchange_token=${shortToken}"`;
            
            document.getElementById('longTokenResult').innerHTML = 
                '<p>Run this command to get your long-lived token:</p>' +
                '<div class="code">' + curlCommand + '</div>';
        }
    </script>
</body>
</html>